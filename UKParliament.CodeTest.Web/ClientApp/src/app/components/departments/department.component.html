<h2 style="font-size:1.5rem; color:#373151; margin-bottom:1rem;">Departments</h2>
<div *ngIf="errorMessage" class="error" style="color:#c00; margin-bottom:1rem;">{{ errorMessage }}</div>
<div style="display:flex; gap:2rem; align-items:flex-start; flex-wrap:wrap; min-height:calc(100vh - 120px); margin-top:0;">
  <div style="flex:2; min-width:125PX;">
    <table *ngIf="departments.length > 0; else noData" class="table table-responsive" style="font-size:0.95rem; min-width:320px; max-width:480px; width:auto; border-collapse:collapse; background:#fff; box-shadow:0 2px 8px rgba(44,42,41,0.08); margin-left:0; border:1px solid #ccc;">
      <caption class="sr-only">List of departments with name and actions</caption>
      <thead style="background:#f8f8fa;">
        <tr>
          <th style="padding:0.5rem 0.5rem; border-bottom:2px solid #e0c7d1; border-right:1px solid #ccc; color:#373151; font-weight:600; width:1%; min-width:120px; max-width:180px; white-space:nowrap;">Name</th>
          <th style="padding:0.5rem 0.25rem; border-bottom:2px solid #e0c7d1; border-right:1px solid #ccc; color:#373151; font-weight:600; width:1%; min-width:56px; max-width:70px; text-align:center; white-space:nowrap;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let dept of departments" style="border-bottom:1px solid #e0c7d1;">
          <td style="padding:0.5rem 0.5rem; border-bottom:1px solid #e0c7d1; border-right:1px solid #ccc; width:1%; min-width:120px; max-width:180px; white-space:nowrap;">{{ dept.Name }}</td>
          <td style="padding:0.5rem 0.25rem; text-align:center; border-right:1px solid #ccc; width:1%; min-width:56px; max-width:70px; border-bottom:1px solid #e0c7d1; white-space:nowrap;">
            <button (click)="onEdit(dept)" class="ukp-btn ukp-btn-edit" style="font-size:0.95rem; padding:0.25rem 0.75rem; margin-right:0.25rem; background:#373151; color:#fff; border:none; border-radius:4px; cursor:pointer;">Edit</button>
            <button (click)="viewPersons(dept)" class="ukp-btn ukp-btn-view" style="font-size:0.95rem; padding:0.25rem 0.5rem; margin-right:0.25rem; background:#43a047; color:#fff; border:none; border-radius:4px; cursor:pointer;">View Persons</button>
            <button 
              (click)="confirmDelete(dept)" 
              class="ukp-btn ukp-btn-delete" 
              [disabled]="hasPersons(dept)"
              [ngStyle]="{ opacity: hasPersons(dept) ? 0.5 : 1 }"
              style="font-size:0.95rem; padding:0.25rem 0.5rem; background:#c00; color:#fff; border:none; border-radius:4px; cursor:pointer;">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <app-confirm-delete-modal
      [show]="showDeleteModal"
      [itemName]="selectedDepartment?.Name || ''"
      (confirm)="confirmDelete()"
      (cancel)="cancelDelete()">
    </app-confirm-delete-modal>

    <div *ngIf="showPersonsModal" class="modal-overlay">
      <div class="modal-content">
        <h3>Persons in Department</h3>
        <ul *ngIf="personsInDepartment.length > 0; else noPersons">
          <li *ngFor="let person of personsInDepartment">{{ person.firstName }} {{ person.lastName }}</li>
        </ul>
        <ng-template #noPersons>
          <p>No persons in this department.</p>
        </ng-template>
        <div class="modal-actions">
          <button (click)="closePersonsModal()" class="ukp-btn ukp-btn-cancel">Close</button>
        </div>
      </div>
    </div>
    <ng-template #noData>
      <p>No departments available.</p>
    </ng-template>
    <button (click)="onAdd()" class="ukp-btn ukp-btn-add" style="margin-top:1rem; font-size:0.95rem; padding:0.25rem 0.75rem; background:#43a047; color:#fff; border:none; border-radius:4px; cursor:pointer;">Add Department</button>
  </div>
  <div *ngIf="selectedDepartment" style="flex:1; min-width:300px; max-width:400px; border-left:1px solid #ccc; padding-left:2rem; font-size:0.95rem; background:#f8f8fa;">
    <form (ngSubmit)="onSave()">
      <label [ngStyle]="{ color: errorMessage === 'Department name cannot be blank.' ? '#c00' : '#373151' }" style="font-size:1rem; font-weight:500;">
        Name<span *ngIf="errorMessage === 'Department name cannot be blank.'" style="color:#c00;">*</span>:
      </label>
      <input [(ngModel)]="selectedDepartment.Name" name="name" required
        [ngStyle]="{
          borderColor: errorMessage === 'Department name cannot be blank.' ? '#c00' : '#ccc',
          background: errorMessage === 'Department name cannot be blank.' ? '#fff6f6' : '#fff'
        }"
        style="width:100%; font-size:1rem; margin-bottom:0.25rem; border:1px solid; border-radius:4px; padding:0.5rem;" />
      <div *ngIf="errorMessage === 'Department name cannot be blank.'" style="color:#c00; font-size:0.95rem; margin-bottom:0.5rem;"><span style="font-weight:normal; color:red;">(Notes * means required field)</span>.</div>
      <div style="display:flex; gap:1rem; margin-top:1rem;">
        <button type="submit" class="ukp-btn ukp-btn-save" style="font-size:1rem; padding:0.5rem 1.5rem; background:#373151; color:#fff; border:none; border-radius:4px; cursor:pointer;">Save</button>
        <button type="button" (click)="onCancelEdit()" class="ukp-btn ukp-btn-cancel" style="font-size:1rem; padding:0.5rem 1.5rem; background:#e0c7d1; color:#373151; border:none; border-radius:4px; cursor:pointer;">Cancel</button>
      </div>
    </form>
  </div>
</div>
